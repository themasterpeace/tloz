

<!DOCTYPE html>
<html lang="es">
    <head>
        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Transportes JR</title>
        
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        
        
        
        <link rel="stylesheet" href="/static/base/css/estilo.css">
        <link rel="stylesheet" href="/static/base/css/estiloo.css">
        <link rel="stylesheet" href="/static/base/vendor/datatables/dataTables.bootstrap4.min.css">
        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
        
        
        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js'></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    </head>
    <body>

        <div id="navbar">
            <div class="elements">
                <div class="navigation">
                    <ul>
                      <li class="list test">
                          <a href="#">
                            <span class="icon"><i class="fas fa-home"></i></span>
                            <ul class="despliegue">
                              <li><a href="/tests/test/test"> <i></i> Test </a></li>
                            </ul>
                          </a>
                      </li>

                      <li class="list home">
                        <a href="#">
                          <span class="icon"><i class="fas fa-warehouse"></i></span>
                          <ul class="despliegue">
                            <li><a href="/link/ingreso_bodega/"> <i></i> Ingreso Bodega</a></li>
                            <li><a href="#">Salida Bodega </a></li>
                            <li><a href="#">Reimprimir Manifiesto</a></li>
                            <li><a href="/link/consulta/">Consulta de Guías</a></li>
                          </ul>
                        </a>
                      </li>
                      <li class="list file">
                        <a href="#">
                          <span class="icon"><i class="fas fa-file"></i></span>
                          <ul class="despliegue">
                            <li><a href="/link/ingreso/new"> <i></i> Ingreso de Guías</a></li>
                            <li><a href="#">Modificación de Guías</a></li>
                            <li><a href="#">Emilinación de Guías</a></li>
                            <li><a href="/link/consulta/">Consulta de Guías</a></li>
                          </ul>
                        </a>
                      </li>
                      <li class="list camera">
                        <a href="#">
                          <span class="icon"><i class="fas fa-camera"></i></span>
                          <ul class="despliegue">
                            
                            <li><a href="/link/correlativo/list">Asignar Correlativo</a></li>
                            <li><a href="#">Emilinación de Guías</a></li>
                            <li><a href="/link/consulta/">Consulta de Guías</a></li>
                          </ul>
                        </a>
                      </li>
                      <li class="list">
                        <a href="#">
                          <span class="icon"><i class="fas fa-comment"></i></span>
                        </a>
                      </li>
                      <li class="list">
                        <a href="#">
                          <span class="icon"><i class="fas fa-chart-bar"></i></span>
                        </a>
                      </li>
                      <li class="list cogs">
                        <a href="#">
                          <span class="icon"><i class="fas fa-cogs"></i></span>
                          <ul class="despliegue">
                            <li><a href="/link/departamento/list"><i class="fas fa-plus"></i>&nbsp; Departamento</a></li>
                            <li><a href="/link/municipio/list"><i class="fas fa-plus"></i>&nbsp; Municipio</a></li>
                            <li><a href="/link/piloto/list"> <i class="fas fa-plus"></i>&nbsp; Pilotos</a></li>
                            <li><a href="/link/ruta/list"> <i class="fas fa-plus"></i>&nbsp; Rutas</a></li>
                            <li><a href="/link/tarifario/list"> <i class="fas fa-plus"></i>&nbsp; Tarifario </a></li>
                            <li><a href="/link/vendedor/list"> <i class="fas fa-plus"></i>&nbsp; Vendedor</a></li>
                            <li><a href="/link/cliente/list"> <i class="fas fa-plus"></i>&nbsp; Cliente</a></li>
                            <li><a href="#"> <i class="fas fa-plus"></i>&nbsp; Boletas de Deposito</a></li>
                          </ul>
                        </a>
                      </li>
                      <li class="list combu">
                        <a href="#">
                          <span class="icon"><i class="fas fa-box"></i></span>
                          <ul class="despliegue">
                            <li>
                              <a href="/zelda/registro/list" id="left" onmouseover="seis()"> <i class="fas fa-gas-pump"></i> Listado de Facturas </a>
                            </li>
                          </ul>
                        </a>
                      </li>
                   <div class="indicator"></div>
                    </ul>
                   </div> 
            </div>
            <div class="user">
              
              <span id="userName">master</span>&nbsp;&nbsp;<a title="Salir de la sesión" href="/logout/"><i class="fas fa-sign-out-alt"></i></a>

              
            </div>
         </div>
        <section id="home"></section>
        <script>
        //  Añade el active al icono que se esté clickeando
        const list=document.querySelectorAll(".list");
        function activeLink(){
            list.forEach((item)=>
              item.classList.remove("active")
            );
            this.classList.add("active");
        }
        list.forEach((item)=>
          item.addEventListener("click",activeLink)
        );
        
        // Esconde y muestra el navbar
        $(document).ready(function(){
            // Si el mouse está sobre el nabvar, se observan los elementos
            $("#navbar").mouseover(function(){
                $(".navigation > ul >li").css("opacity", "1");
                $(".indicator").css("opacity", "1");
                $(".navigation > ul >li").css("visibility", "visible");
                $(".indicator").css("visibility", "visible");
                $("#navbar > .user > #userName").css("visibility", "visible");
                $("#navbar > .user > #userName").css("opacity", "1");
            });
            // Si el mouse no está sobre el nabvar, no se observan los elementos
            $("#navbar").mouseout(function(){
                $(".navigation > ul >li").css("opacity", "0");
                $(".indicator").css("opacity", "0");
                $(".navigation > ul >li").css("visibility", "hidden");
                $(".indicator").css("visibility", "hidden");
                $("#navbar > .user > #userName").css("visibility", "hidden");
                $("#navbar > .user > #userName").css("opacity", "0");
            });
        });
        // Funcion para el .list que llevará un despliegue
        $("li.list.home").on("click",function() {
          // Se agrega la clase .des1 cuando se clickea en el list con despliegue
          document.querySelector("li.list.home").classList.toggle("des1");
        });
        $("li.list.cogs").on("click",function() {
          // Se agrega la clase .des1 cuando se clickea en el list con despliegue
          document.querySelector("li.list.cogs").classList.toggle("des1");
        });
        $("li.list.file").on("click",function() {
          // Se agrega la clase .des1 cuando se clickea en el list con despliegue
          document.querySelector("li.list.file").classList.toggle("des1");
        });
        $("li.list.combu").on("click",function() {
          // Se agrega la clase .des1 cuando se clickea en el list con despliegue
          document.querySelector("li.list.combu").classList.toggle("des1");
        });
        $("li.list.camera").on("click",function() {
          // Se agrega la clase .des1 cuando se clickea en el list con despliegue
          document.querySelector("li.list.camera").classList.toggle("des1");
        });
        $("li.list.test").on("click",function() {
          // Se agrega la clase .des1 cuando se clickea en el list con despliegue
          document.querySelector("li.list.test").classList.toggle("des1");
        });
        // Se elimina la clase .des1 cuando se clickea fuera de él
        $(document).on("click",function(e) {
          const cogs = $("li.list.cogs");
          const home = $("li.list.home");
          const file = $("li.list.file");
          const combu = $("li.list.combu");
          const camera = $("li.list.camera");
          const test = $("li.list.test");

          if (!cogs.is(e.target) && cogs.has(e.target).length === 0) { 
            document.querySelector("li.list.cogs").classList.remove("des1");
          }
          if(!home.is(e.target) && home.has(e.target).length === 0){
            document.querySelector("li.list.home").classList.remove("des1");
          }
          if(!combu.is(e.target) && combu.has(e.target).length === 0){
            document.querySelector("li.list.combu").classList.remove("des1");
          }
          if(!file.is(e.target) && file.has(e.target).length === 0){
            document.querySelector("li.list.file").classList.remove("des1");
          }
          if(!camera.is(e.target) && camera.has(e.target).length === 0){
            document.querySelector("li.list.camera").classList.remove("des1");
          }
          if(!test.is(e.target) && test.has(e.target).length === 0){
            document.querySelector("li.list.test").classList.remove("des1");
          }
        });
        // Se elimina la clase .des1 al ocultarse el navbar
/*         $("#navbar").on("mouseleave",function(e) {
          const container = $("li.list.cogs");

          if (!container.is(e.target) && container.has(e.target).length === 0) { 
            document.querySelector("li.list.cogs").classList.remove("des1");
          }
        }); */
        </script>
    </div>
    
    <div class="modal fade" id="popup"></div>

        
    <br><br>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <div class="row ing_gui" >

        <div class="card ing_gui">
            <div class="cardbody" >
                <h2>Ingreso de Guías</h2>
                <hr>
                
                  </div>
               
                <form method="POST" name="ing_guias">
                    <!--Esta es la seccion de ingreso de numero de guia fecha y manifiesto -->
                    <input type="hidden" name="csrfmiddlewaretoken" value="shlccWcurrZXZOMgdyiXH5atyphqG3plf5TkLrppEfPf0AiGh5z5RYHLq5zCCKCN">
                    <input type="hidden" name="form-TOTAL_FORMS" value="1" id="id_form-TOTAL_FORMS"><input type="hidden" name="form-INITIAL_FORMS" value="0" id="id_form-INITIAL_FORMS"><input type="hidden" name="form-MIN_NUM_FORMS" value="0" id="id_form-MIN_NUM_FORMS"><input type="hidden" name="form-MAX_NUM_FORMS" value="1000" id="id_form-MAX_NUM_FORMS">
                    
                        <tr>
    <th><label for="id_form-0-no_guia">Numero guia:</label></th>
    <td>
      
      <input type="text" name="form-0-no_guia" maxlength="6" class="form-control" id="id_form-0-no_guia">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-fecha">Fecha:</label></th>
    <td>
      
      <input type="text" name="form-0-fecha" class="form-control" id="id_form-0-fecha">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-no_manifiesto">Numero Manifiesto:</label></th>
    <td>
      
      <input type="text" name="form-0-no_manifiesto" maxlength="5" class="form-control" id="id_form-0-no_manifiesto">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-codigo_cliente">Codigo Cliente:</label></th>
    <td>
      
      <input type="text" name="form-0-codigo_cliente" maxlength="8" class="form-control" id="id_form-0-codigo_cliente">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-remitente">Remitente:</label></th>
    <td>
      
      <input type="text" name="form-0-remitente" maxlength="200" class="form-control" id="id_form-0-remitente">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-dirrem">Direccion Remitente:</label></th>
    <td>
      
      <input type="text" name="form-0-dirrem" maxlength="300" class="form-control" id="id_form-0-dirrem">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-tel">Telefono:</label></th>
    <td>
      
      <input type="text" name="form-0-tel" maxlength="9" class="form-control" id="id_form-0-tel">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-zona">Zona:</label></th>
    <td>
      
      <input type="text" name="form-0-zona" maxlength="2" class="form-control" id="id_form-0-zona">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-muni">Municipio:</label></th>
    <td>
      
      <input type="text" name="form-0-muni" maxlength="50" class="form-control" id="id_form-0-muni">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-origen">Origen:</label></th>
    <td>
      
      <input type="text" name="form-0-origen" maxlength="50" class="form-control" id="id_form-0-origen">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-ruta">Ruta:</label></th>
    <td>
      
      <input type="text" name="form-0-ruta" maxlength="3" class="form-control" id="id_form-0-ruta">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-codigo_desti">Codigo Dest:</label></th>
    <td>
      
      <input type="text" name="form-0-codigo_desti" maxlength="8" class="form-control" id="id_form-0-codigo_desti">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-destinatario">Destinatario:</label></th>
    <td>
      
      <input type="text" name="form-0-destinatario" maxlength="100" class="form-control" id="id_form-0-destinatario">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-dirdes">Direccion Dest:</label></th>
    <td>
      
      <input type="text" name="form-0-dirdes" maxlength="300" class="form-control" id="id_form-0-dirdes">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-teldes">Telefono:</label></th>
    <td>
      
      <input type="text" name="form-0-teldes" maxlength="9" class="form-control" id="id_form-0-teldes">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-zonades">Zona:</label></th>
    <td>
      
      <input type="text" name="form-0-zonades" maxlength="2" class="form-control" id="id_form-0-zonades">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-munides">Municipio:</label></th>
    <td>
      
      <input type="text" name="form-0-munides" maxlength="50" class="form-control" id="id_form-0-munides">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-destino">Destino:</label></th>
    <td>
      
      <input type="text" name="form-0-destino" maxlength="50" class="form-control" id="id_form-0-destino">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-rutades">Ruta:</label></th>
    <td>
      
      <input type="text" name="form-0-rutades" maxlength="3" class="form-control" id="id_form-0-rutades">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-codigo">Codigo:</label></th>
    <td>
      
      <input type="text" name="form-0-codigo" maxlength="8" class="form-control" id="id_form-0-codigo">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-cliente">Cliente:</label></th>
    <td>
      
      <input type="text" name="form-0-cliente" maxlength="150" class="form-control" id="id_form-0-cliente">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-tipo_envio">Tipo Envio:</label></th>
    <td>
      
      <select name="form-0-tipo_envio" class="form-control" id="id_form-0-tipo_envio">
  <option value="" selected>---------</option>

  <option value="1">SOBRE</option>

  <option value="2">PAQUETE</option>

  <option value="3">PAGO CONTRA ENTREGA</option>

</select>
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-descripcion">Descripcion:</label></th>
    <td>
      
      <input type="text" name="form-0-descripcion" maxlength="150" class="form-control" id="id_form-0-descripcion">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-cantidad">Cantidad:</label></th>
    <td>
      
      <input type="number" name="form-0-cantidad" value="0" class="form-control" id="id_form-0-cantidad">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-peso">Peso:</label></th>
    <td>
      
      <input type="number" name="form-0-peso" value="0" step="any" class="form-control" id="id_form-0-peso">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-precio">Precio:</label></th>
    <td>
      
      <input type="number" name="form-0-precio" value="0" step="any" class="form-control" id="id_form-0-precio">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-observa">Observaciones:</label></th>
    <td>
      
      <textarea name="form-0-observa" cols="40" rows="10" maxlength="500" class="form-control" id="id_form-0-observa">
</textarea>
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-boleta_cte">No. Boleta CE:</label></th>
    <td>
      
      <input type="text" name="form-0-boleta_cte" maxlength="6" class="form-control" id="id_form-0-boleta_cte">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-ptpae">Valor Total Producto:</label></th>
    <td>
      
      <input type="number" name="form-0-ptpae" value="0" step="any" class="form-control" id="id_form-0-ptpae">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-comision">Comision:</label></th>
    <td>
      
      <input type="number" name="form-0-comision" value="0" step="any" class="form-control" id="id_form-0-comision">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-totenv">Total Envio:</label></th>
    <td>
      
      <input type="number" name="form-0-totenv" value="0" class="form-control" id="id_form-0-totenv">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-sub_total">Subtotal:</label></th>
    <td>
      
      <input type="number" name="form-0-sub_total" value="0" step="any" class="form-control" id="id_form-0-sub_total">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-descuento">Descuento:</label></th>
    <td>
      
      <input type="number" name="form-0-descuento" value="0" step="any" class="form-control" id="id_form-0-descuento">
      
      
    </td>
  </tr>

  <tr>
    <th><label for="id_form-0-total">Total:</label></th>
    <td>
      
      <input type="number" name="form-0-total" value="0" step="any" class="form-control" id="id_form-0-total">
      
      
        
      
    </td>
  </tr>
                    
                   <div class="col">
                    <button type="submit" class="btn btn-danger"><span class="fa fa-save"></span> Guardar</button>
                    <!--<a href="/link/departamento/list" class="btn btn-success"><span class="fa fa-undo"></span>Cancelar</a>-->
                    <button type="button" class="btn btn-success" onclick="return cerrar_modal()">
                     Salir   
                    </button>
                </div>
                </form>
                
   
            </div>
        </div>
    </div>

    
        
<!-- Bootstrap core JavaScript-->
<script src="/static/base/vendor/jquery/jquery.min.js"></script>
<script src="/static/base/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="/static/base/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="/static/base/js/sb-admin-2.min.js"></script>

<!-- Page level plugins -->
<script src="/static/base/vendor/datatables/jquery.dataTables.min.js"></script>
<script src="/static/base/vendor/datatables/dataTables.bootstrap4.min.js"></script>

<script src="/static/base/vendor/jquery_confirm/jquery-confirm.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js" integrity="sha256-FEqEelWI3WouFOo2VWP/uJfs1y8KJ++FLh2Lbqc8SJk=" crossorigin="anonymous"></script>  

<script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table-locale-all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>



<script src="/static/base/js/jquery.chained.min.js"></script>



    <script>
        $(".tipo_envio").change(function(){
            buscarProducto(this.id);
        });

        function buscarProducto(long_id){
            var id = long_id.split("_").slice(-1);
            var codigo = $("#id_tipo_envio_" + id).val();
            if(codigo===""){
                return false;
            }

            var path = "/api/v1/producto/" + codigo;
            $.ajax({
                type:"GET",
                url: path,
                success: function(r){
                    console.log(r);
                    console.log(r.estado);

                    if(!r.estado){
                        mensaje("Producto No Tiene Existencia o está inactivo",'orange')
                        $("#id_tipo_envio_" + id).val("");
                        $("#id_descripcion_" + id).val("");
                        $("#id_precio_" + id).val("0.00");
                        $("#id_tipo_envio_" + id).focus();
                        return false;
                    }

                    $("#id_tipo_envio_" + id).val(r.id);
                    $("#id_descripcion_" + id).val(r.descripcion);
                    $("#id_precio_" + id).val(r.precio);
                    $("#id_tipo_envio_" + id).focus();
                },
                error: function(a,b,c){
                    console.log(a);
                    if(a.status==404){
                        mensaje("Producto -" + codigo + "- No Encontrado o No Existe",'red');
                        $("#id_tipo_envio_" + id).val("");
                        $("#id_descripcion_" + id).val("");
                        $("#id_precio_" + id).val("0.00");
                        $("#id_tipo_envio_" + id).focus();
                    }
                }
            });
        }
        var contador = 0
        $("#addRow").click(function () {
            contador++
            var html = '';
            html += `<table class="table table-striped table-hover">
            <td><button id="removeRow" type="button" class="btn btn-danger"><i class="fas fa-times-circle"> Quitar</i></button></td>
            <td><input type="number" name="tipo_envio[]" required="required" id="id_tipo_envio_` + contador + `" class="tipo_envio"></td>
            <td><input type="text" name="descripcion[]" maxlength="150" required="required" id="id_descripcion_` + contador + `" class="descripcion"></td>
            <td><input type="number" name="cantidad[]" min="0" value="0" required="required" id="id_cantidad_` + contador + `" class="cantidad"></td>
            <td><input type="number" name="peso[]" min="0" value="0" step="any" required="required" id="id_peso_` + contador + `" class="peso"></td>
            <td><input type="number" name="precio[]" min="0" value="0" step="any" required="required" id="id_precio_` + contador + `" class="precio"></td>
            </table>`;
            $('#newRow').append(html);

            var a = document.querySelectorAll(".tipo_envio")
            a.forEach(function(e){
                e.addEventListener('change', function(){
                    buscarProducto(e.id)
                })
            })
        });

        // remove row
        $(document).on('click', '#removeRow', function () {
            $(this).closest('.table').remove();
            // contador--
        });
        function calcular_detalle(){
            var cant = $("#id_cantidad_0+1").val();
            var prec =$('#id_precio_0+1').val();
            var desc = $('#id_descuento_0+1').val();
            var vte = $('#id_ptpae_0+1').val();
            var comi = $('#id_comision_0+1').val();       
            var res = vte * 0.05;

            var stotal = cant * prec;
            var total  = stotal - desc;

            $('#id_sub_total').val(stotal);
            $('#id_total').val(total);
            
        }
        function calcular_comi(){
            var vte = $('#id_ptpae').val();
            var comi = $('#id_comision').val();       
            var res = vte * 0.05;

            var total  = $('#id_sub_total').val() - $('#id_descuento').val() + res;

            $('#id_comision').val(res);
            $('#id_total').val(total);
        }

        function buscarCliente()
        {    
            var codigo = $("#id_codigo_cliente").val();
            if(codigo===""){
                return false;
            }
    
            var path = "/api/v1/clientes/" + codigo;
            $.ajax({
                type:"GET",
                url: path,
                success: function(r){
                    console.log(r);
                    //console.log(r.existencia);
                    console.log(r.estado);
    
                    if(!r.estado){
                        mensaje("Cliente inexistente o inactivo",'orange');
                        $("#id_codigo_cliente").val("");
                        $("#id_remitente").val("");
                        $("#id_dirrem").val("");
                        $("#id_tel").val("");
                        $("#id_muni").val("");
                        $("#id_origen").val("");
                        $("#id_codigo_cliente").focus();
                        return false;
                    }else{
                    $("#id_codigo_cliente").val(r.codigo_cliente);
                    $("#id_remitente").val(r.razonsoc);
                    $("#id_dirrem").val(r.direccion);
                    $("#id_tel").val(r.telefono);
                    $("#id_muni").val(r.municipio);
                    $("#id_origen").val(r.depto);
                    $("#id_codigo_cliente").focus();
                    }
    
                },
                error: function(a,b,c){
                    console.log(a);
                    // console.log(b);
                    // console.log(c);
                    // console.log(a.status)
                    // console.log(a.responseText.detail);
                    // a.responseText["detail"]
                    // mensaje(c,'red');
                    if(a.status==404){
                        mensaje("Cliente -" + codigo_cliente + "- no encontrado o inexistente",'red');
                        $("#id_codigo_cliente").val("");
                        $("#id_remitente").val("");
                        $("#id_dirrem").val("");
                        $("#id_tel").val("");
                        $("#id_muni").val("");
                        $("#id_origen").val("");
                        $("#id_codigo_cliente").focus();
                    }
                }
            });  
        }
        function buscarClientedes()
        {    
            var codigo = $("#id_codigo_desti").val();
            if(codigo===""){
                return false;
            }
    
            var path = "/api/v1/clientes/" + codigo;
            $.ajax({
                type:"GET",
                url: path,
                success: function(r){
                    console.log(r);
                    //console.log(r.existencia);
                    console.log(r.estado);
    
                    if(!r.estado){
                        mensaje("Cliente inexistente o inactivo",'orange');
                        $("#id_codigo_desti").val("");
                        $("#id_destinatario").val("");
                        $("#id_dirdes").val("");
                        $("#id_teldes").val("");
                        $("#id_munides").val("");
                        $("#id_destino").val("");
                        $("#id_codigo_desti").focus();
                        return false;
                    }else{
                    $("#id_codigo_desti").val(r.codigo_cliente);
                    $("#id_destinatario").val(r.razonsoc);
                    $("#id_dirdes").val(r.direccion);
                    $("#id_teldes").val(r.telefono);
                    $("#id_munides").val(r.municipio);
                    $("#id_destino").val(r.depto);
                    $("#id_codigo_desti").focus();
                    }
    
                },
                error: function(a,b,c){
                    console.log(a);
                    // console.log(b);
                    // console.log(c);
                    // console.log(a.status)
                    // console.log(a.responseText.detail);
                    // a.responseText["detail"]
                    // mensaje(c,'red');
                    if(a.status==404){
                        mensaje("Cliente -" + codigo_cliente + "- no encontrado o inexistente",'red');
                        $("#id_codigo_desti").val("");
                        $("#id_destinatario").val("");
                        $("#id_dirdes").val("");
                        $("#id_codigo_desti").focus();
                    }
    
                }
    
            });

           
        }

        function buscarfpago()
        {    
            var codigo = $("#id_codigo").val();
            if(codigo===""){
                return false;
            }
    
            var path = "/api/v1/clientes/" + codigo;
            $.ajax({
                type:"GET",
                url: path,
                success: function(r){
                    console.log(r);
                    //console.log(r.existencia);
                    console.log(r.estado);
    
                    if(!r.estado){
                        mensaje("Cliente inexistente o inactivo",'orange');
                        $("#id_codigo").val("");
                        $("#id_cliente").val("");
                        
                        $("#id_codigo").focus();
                        return false;
                    }else{
                    $("#id_codigo").val(r.codigo_cliente);
                    $("#id_cliente").val(r.razonsoc);
                    $("#id_codigo_desti").focus();
                    }
    
                },
                error: function(a,b,c){
                    console.log(a);
                   
                    if(a.status==404){
                        mensaje("Cliente -" + codigo_cliente + "- no encontrado o inexistente",'red');
                        $("#id_codigo").val("");
                        $("#id_cliente").val("");
                        $("#id_codigo").focus();
                    }
    
                }
    
            });

           
        }
    $("#id_codigo_cliente").change(function(e){
            buscarCliente();
    });
    $("#id_codigo_desti").change(function(e){
            buscarClientedes();
    });
    $("#id_codigo").change(function(e){
            buscarfpago();
    });
    $("#id_precio_0").change(function(){
            calcular_detalle();
    });
    $("#id_ptpae").change(function(){
        calcular_comi();
    });

    
    // Funcion que agrega guión(-) al escribir 3 caracteres
    var idco = $("input#id_codigo_cliente");
    var idcodes = $("input#id_codigo_desti");
    // Código Cliente Funcion
    idco.keyup(function(event) {
        if (event.keyCode !== 8) {
            value = idco.val()

            if (value.length == 3) {
                idco.val(value + '-');
            }
        }
    })
    idcodes.keyup(function(event) {
        if (event.keyCode !== 8) {
            value = idcodes.val()

            if (value.length == 3) {
                idcodes.val(value + '-');
            }
        }
    })
    // Función para abrir popup de confirmación No.Guia
    $( ".boton-modal").click(function() {
        Swal.fire({
            title: '<strong>Confirmación del <u>No. Guía</u></strong>',
            icon: 'info',
            html:
                '<input type="text" id="conf_noguia" placeholder="Introduce nuevamente el No. Guía"><br><br>',
            showCloseButton: true,
            showConfirmButton: false,
        });

        const conf = $('input#conf_noguia');
        const codNog = $('input#id_no_guia');

        conf.change(function(){
            if (conf.val() == codNog.val()) {
                Swal.close()
                document.ing_guias.submit()
                
            }else{
                Swal.fire({
                    position: 'top-end',
                    icon: 'error',
                    title: 'No. Guía no coincide. ¡Intentalo de nuevo!',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true
                })
            }
        })
    });
    // Funcion para comprobar el estado del checkbox
    $('#switch-label').prop("checked", false);
    $('#switch-label').click(function(){
        if($('#switch-label').is(":checked")){
            $('.ing_guiGrid.col3.anim.hide').removeClass('hide');
        }else{
            $('.ing_guiGrid.col3.anim').addClass('hide');
        }
    });
    // Funcion para pasar a mayusculas datos de los inputs
    $(document).ready( function () {
        $("input").on("keypress", function () {
            $input=$(this);
            setTimeout(function () {
                $input.val($input.val().toUpperCase());
            },50);
        })
    });
    // Funcion para poner siempre fecha actual
    Date.prototype.toDateInputValue = (function() {
        var local = new Date(this);
        local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
        return local.toJSON().slice(0,10);
    });
    
    $(document).ready( function() {
        $('#id_fecha').val(new Date().toDateInputValue());
    });
    // Funcion Abrir Modal buscar_remi
    $(document).keydown(function(e){
        if(e.keyCode===113){
            abrir_modal("/link/buscar_cli")
        }
    })
    // Funciion abrir modal buscar_desti
    $(document).keydown(function(e){
        if(e.keyCode===115){
            alert("SAdkjsaop")
        }
    })
    // Funcion guardar variable nomanifiesto en cookie
    $('#id_no_manifiesto').change(function(){
        var idmani = $('#id_no_manifiesto');
        sessionStorage.setItem('nomanifiesto', idmani.val());
    })
    $('#id_no_manifiesto').val(sessionStorage.getItem('nomanifiesto'));
    // Funcion limpiar formulario
    $(".reset").click(function() {
        $('input').not("input[name=no_manifiesto], input[name=fecha]").val("")
    })

    </script>


<script>
    function abrir_modal(url)
    {

      $("#popup").load(url, function(){
        $(this).modal({
          backdrop:'static',
          keyboard: false
        })
        $(this).modal('show');
      });
      return false;
    }

    function cerrar_modal()
    {
      $('#popup').modal('hide');
      return false;
    }   
</script>



    </body>
</html>